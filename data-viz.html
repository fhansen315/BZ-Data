<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BZ-Data - Live Analytics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .chart-container { height: 400px; margin-bottom: 2rem; }
        .metric-card { text-align: center; padding: 1.5rem; }
        .metric-value { font-size: 2rem; font-weight: bold; color: #0066CC; }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="index.html">← Back to Home</a>
            <span class="navbar-text">BZ-Data Live Analytics</span>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row mb-4">
            <div class="col">
                <h1>FX Modality Analytics Dashboard</h1>
                <p class="lead">Interactive visualizations of current FX data</p>
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card metric-card">
                    <div class="metric-value" id="total-volume">$12.4M</div>
                    <div>Total Volume</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card metric-card">
                    <div class="metric-value" id="total-transactions">109</div>
                    <div>Transactions</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card metric-card">
                    <div class="metric-value" id="avg-transaction">$114K</div>
                    <div>Avg Transaction</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card metric-card">
                    <div class="metric-value" id="growth-rate">+20%</div>
                    <div>9-Month Growth</div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="row">
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Volume by Institution</h5>
                    </div>
                    <div class="card-body">
                        <div id="institution-chart" class="chart-container"></div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Volume by Modality</h5>
                    </div>
                    <div class="card-body">
                        <div id="modality-chart" class="chart-container"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Monthly Trends</h5>
                    </div>
                    <div class="card-body">
                        <div id="trend-chart" class="chart-container"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Institution × Modality Heatmap</h5>
                    </div>
                    <div class="card-body">
                        <div id="heatmap-chart" class="chart-container"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data based on our CSV
        const institutionData = [
            { institution: 'Bank_Gamma', volume: 5055000 },
            { institution: 'Bank_Alpha', volume: 4055000 },
            { institution: 'Bank_Beta', volume: 3282000 }
        ];

        const modalityData = [
            { modality: 'Swap', volume: 4695000 },
            { modality: 'Spot', volume: 3754000 },
            { modality: 'Forward', volume: 2651000 },
            { modality: 'Options', volume: 1292000 }
        ];

        const monthlyData = [
            { month: '2024-01', volume: 1252000 },
            { month: '2024-02', volume: 1318000 },
            { month: '2024-03', volume: 1286000 },
            { month: '2024-04', volume: 1359000 },
            { month: '2024-05', volume: 1407000 },
            { month: '2024-06', volume: 1385000 },
            { month: '2024-07', volume: 1455000 },
            { month: '2024-08', volume: 1428000 },
            { month: '2024-09', volume: 1502000 }
        ];

        // Institution Bar Chart
        const institutionTrace = {
            x: institutionData.map(d => d.institution),
            y: institutionData.map(d => d.volume),
            type: 'bar',
            marker: { color: '#0066CC' },
            text: institutionData.map(d => '$' + (d.volume/1000000).toFixed(1) + 'M'),
            textposition: 'auto'
        };

        Plotly.newPlot('institution-chart', [institutionTrace], {
            title: '',
            xaxis: { title: 'Institution' },
            yaxis: { title: 'Volume ($)', tickformat: '$,.0f' },
            margin: { t: 20 }
        });

        // Modality Pie Chart
        const modalityTrace = {
            labels: modalityData.map(d => d.modality),
            values: modalityData.map(d => d.volume),
            type: 'pie',
            textinfo: 'label+percent',
            textposition: 'auto',
            marker: {
                colors: ['#0066CC', '#28A745', '#FFC107', '#DC3545']
            }
        };

        Plotly.newPlot('modality-chart', [modalityTrace], {
            title: '',
            margin: { t: 20 }
        });

        // Monthly Trend Line Chart
        const trendTrace = {
            x: monthlyData.map(d => d.month),
            y: monthlyData.map(d => d.volume),
            type: 'scatter',
            mode: 'lines+markers',
            line: { color: '#0066CC', width: 3 },
            marker: { size: 8 }
        };

        Plotly.newPlot('trend-chart', [trendTrace], {
            title: '',
            xaxis: { title: 'Month' },
            yaxis: { title: 'Volume ($)', tickformat: '$,.0f' },
            margin: { t: 20 }
        });

        // Heatmap
        const institutions = ['Bank_Alpha', 'Bank_Beta', 'Bank_Gamma'];
        const modalities = ['Spot', 'Forward', 'Swap', 'Options'];
        
        // Sample heatmap data (approximated from our dataset)
        const heatmapData = [
            [1200000, 850000, 1550000, 455000],  // Bank_Alpha
            [1050000, 720000, 1350000, 320000],  // Bank_Beta
            [1504000, 1081000, 1795000, 517000]  // Bank_Gamma
        ];

        const heatmapTrace = {
            z: heatmapData,
            x: modalities,
            y: institutions,
            type: 'heatmap',
            colorscale: 'Blues',
            showscale: true,
            text: heatmapData.map(row => 
                row.map(val => '$' + (val/1000000).toFixed(1) + 'M')
            ),
            texttemplate: '%{text}',
            textfont: { color: 'white', size: 12 }
        };

        Plotly.newPlot('heatmap-chart', [heatmapTrace], {
            title: '',
            xaxis: { title: 'Modality' },
            yaxis: { title: 'Institution' },
            margin: { t: 20 }
        });

        // Add some interactivity
        document.addEventListener('DOMContentLoaded', function() {
            // Animate numbers on load
            const animateValue = (element, start, end, duration) => {
                const range = end - start;
                const increment = range / (duration / 16);
                let current = start;
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= end) {
                        current = end;
                        clearInterval(timer);
                    }
                    if (element.id === 'total-volume') {
                        element.textContent = '$' + (current/1000000).toFixed(1) + 'M';
                    } else if (element.id === 'avg-transaction') {
                        element.textContent = '$' + Math.round(current/1000) + 'K';
                    } else if (element.id === 'growth-rate') {
                        element.textContent = '+' + Math.round(current) + '%';
                    } else {
                        element.textContent = Math.round(current);
                    }
                }, 16);
            };

            // Animate metrics
            setTimeout(() => {
                animateValue(document.getElementById('total-volume'), 0, 12392000, 2000);
                animateValue(document.getElementById('total-transactions'), 0, 109, 1500);
                animateValue(document.getElementById('avg-transaction'), 0, 113688, 2000);
                animateValue(document.getElementById('growth-rate'), 0, 20, 1500);
            }, 500);
        });
    </script>
</body>
</html>
